<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Default formula blueprint — default_formula_blueprint • hardhat</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Default formula blueprint — default_formula_blueprint"><meta name="description" content="This pages holds the details for the formula preprocessing blueprint. This
is the blueprint used by default from mold() if x is a formula."><meta property="og:description" content="This pages holds the details for the formula preprocessing blueprint. This
is the blueprint used by default from mold() if x is a formula."><meta property="og:image" content="https://hardhat.tidymodels.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="hardhat.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hardhat</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.4.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/forge.html">Forging data for predictions</a></li>
    <li><a class="dropdown-item" href="../articles/mold.html">Molding data for modeling</a></li>
    <li><a class="dropdown-item" href="../articles/package.html">Creating Modeling Packages With hardhat</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/12/hardhat-0-1-0/">Version 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/hardhat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Default formula blueprint</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/hardhat/blob/main/R/blueprint-formula-default.R" class="external-link"><code>R/blueprint-formula-default.R</code></a>, <a href="https://github.com/tidymodels/hardhat/blob/main/R/mold.R" class="external-link"><code>R/mold.R</code></a></small>
      <div class="d-none name"><code>default_formula_blueprint.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This pages holds the details for the formula preprocessing blueprint. This
is the blueprint used by default from <code><a href="mold.html">mold()</a></code> if <code>x</code> is a formula.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">default_formula_blueprint</span><span class="op">(</span></span>
<span>  intercept <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  allow_novel_levels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  indicators <span class="op">=</span> <span class="st">"traditional"</span>,</span>
<span>  composition <span class="op">=</span> <span class="st">"tibble"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'formula'</span></span>
<span><span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">...</span>, blueprint <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-intercept">intercept<a class="anchor" aria-label="anchor" href="#arg-intercept"></a></dt>
<dd><p>A logical. Should an intercept be included in the
processed data? This information is used by the <code>process</code> function
in the <code>mold</code> and <code>forge</code> function list.</p></dd>


<dt id="arg-allow-novel-levels">allow_novel_levels<a class="anchor" aria-label="anchor" href="#arg-allow-novel-levels"></a></dt>
<dd><p>A logical. Should novel factor levels be allowed at
prediction time? This information is used by the <code>clean</code> function in the
<code>forge</code> function list, and is passed on to <code><a href="scream.html">scream()</a></code>.</p></dd>


<dt id="arg-indicators">indicators<a class="anchor" aria-label="anchor" href="#arg-indicators"></a></dt>
<dd><p>A single character string. Control how factors are
expanded into dummy variable indicator columns. One of:</p><ul><li><p><code>"traditional"</code> - The default. Create dummy variables using the
traditional <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix()</a></code> infrastructure. Generally this creates
<code>K - 1</code> indicator columns for each factor, where <code>K</code> is the number of
levels in that factor.</p></li>
<li><p><code>"none"</code> - Leave factor variables alone. No expansion is done.</p></li>
<li><p><code>"one_hot"</code> - Create dummy variables using a one-hot encoding approach
that expands unordered factors into all <code>K</code> indicator columns, rather than
<code>K - 1</code>.</p></li>
</ul></dd>


<dt id="arg-composition">composition<a class="anchor" aria-label="anchor" href="#arg-composition"></a></dt>
<dd><p>Either "tibble", "matrix", or "dgCMatrix" for the format
of the processed predictors. If "matrix" or "dgCMatrix" are chosen, all of
the predictors must be numeric after the preprocessing method has been
applied; otherwise an error is thrown.</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A formula specifying the predictors and the outcomes.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame or matrix containing the outcomes and predictors.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Not used.</p></dd>


<dt id="arg-blueprint">blueprint<a class="anchor" aria-label="anchor" href="#arg-blueprint"></a></dt>
<dd><p>A preprocessing <code>blueprint</code>. If left as <code>NULL</code>, then a
<code>default_formula_blueprint()</code> is used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For <code>default_formula_blueprint()</code>, a formula blueprint.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>While not different from base R, the behavior of expanding factors into
dummy variables when <code>indicators = "traditional"</code> and an intercept is <em>not</em>
present is not always intuitive and should be documented.</p><ul><li><p>When an intercept is present, factors are expanded into <code>K-1</code> new columns,
where <code>K</code> is the number of levels in the factor.</p></li>
<li><p>When an intercept is <em>not</em> present, the first factor is expanded into
all <code>K</code> columns (one-hot encoding), and the remaining factors are expanded
into <code>K-1</code> columns. This behavior ensures that meaningful predictions can
be made for the reference level of the first factor, but is not the exact
"no intercept" model that was requested. Without this behavior, predictions
for the reference level of the first factor would always be forced to <code>0</code>
when there is no intercept.</p></li>
</ul><p>Offsets can be included in the formula method through the use of the inline
function <code><a href="https://rdrr.io/r/stats/offset.html" class="external-link">stats::offset()</a></code>. These are returned as a tibble with 1 column
named <code>".offset"</code> in the <code>$extras$offset</code> slot of the return value.</p>
    </div>
    <div class="section level2">
    <h2 id="mold">Mold<a class="anchor" aria-label="anchor" href="#mold"></a></h2>



<p>When <code><a href="mold.html">mold()</a></code> is used with the default formula blueprint:</p><ul><li><p>Predictors</p><ul><li><p>The RHS of the <code>formula</code> is isolated, and converted to its own
1 sided formula: <code>~ RHS</code>.</p></li>
<li><p>Runs <code><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">stats::model.frame()</a></code> on the RHS formula and uses <code>data</code>.</p></li>
<li><p>If <code>indicators = "traditional"</code>, it then runs <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">stats::model.matrix()</a></code>
on the result.</p></li>
<li><p>If <code>indicators = "none"</code>, factors are removed before <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix()</a></code>
is run, and then added back afterwards. No interactions or inline
functions involving factors are allowed.</p></li>
<li><p>If <code>indicators = "one_hot"</code>, it then runs <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">stats::model.matrix()</a></code> on the
result using a contrast function that creates indicator columns for all
levels of all factors.</p></li>
<li><p>If any offsets are present from using <code><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset()</a></code>, then they are
extracted with <code><a href="model_offset.html">model_offset()</a></code>.</p></li>
<li><p>If <code>intercept = TRUE</code>, adds an intercept column.</p></li>
<li><p>Coerces the result of the above steps to a tibble.</p></li>
</ul></li>
<li><p>Outcomes</p><ul><li><p>The LHS of the <code>formula</code> is isolated, and converted to its own
1 sided formula: <code>~ LHS</code>.</p></li>
<li><p>Runs <code><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">stats::model.frame()</a></code> on the LHS formula and uses <code>data</code>.</p></li>
<li><p>Coerces the result of the above steps to a tibble.</p></li>
</ul></li>
</ul></div>
    <div class="section level2">
    <h2 id="forge">Forge<a class="anchor" aria-label="anchor" href="#forge"></a></h2>



<p>When <code><a href="forge.html">forge()</a></code> is used with the default formula blueprint:</p><ul><li><p>It calls <code><a href="shrink.html">shrink()</a></code> to trim <code>new_data</code> to only the required columns and
coerce <code>new_data</code> to a tibble.</p></li>
<li><p>It calls <code><a href="scream.html">scream()</a></code> to perform validation on the structure of the columns
of <code>new_data</code>.</p></li>
<li><p>Predictors</p><ul><li><p>It runs <code><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">stats::model.frame()</a></code> on <code>new_data</code> using the stored terms
object corresponding to the <em>predictors</em>.</p></li>
<li><p>If, in the original <code><a href="mold.html">mold()</a></code> call, <code>indicators = "traditional"</code> was
set, it then runs <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">stats::model.matrix()</a></code> on the result.</p></li>
<li><p>If, in the original <code><a href="mold.html">mold()</a></code> call, <code>indicators = "none"</code> was set, it
runs <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">stats::model.matrix()</a></code> on the result without the factor columns,
and then adds them on afterwards.</p></li>
<li><p>If, in the original <code><a href="mold.html">mold()</a></code> call, <code>indicators = "one_hot"</code> was set, it
runs <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">stats::model.matrix()</a></code> on the result with a contrast function that
includes indicators for all levels of all factor columns.</p></li>
<li><p>If any offsets are present from using <code><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset()</a></code> in the original call
to <code><a href="mold.html">mold()</a></code>, then they are extracted with <code><a href="model_offset.html">model_offset()</a></code>.</p></li>
<li><p>If <code>intercept = TRUE</code> in the original call to <code><a href="mold.html">mold()</a></code>, then an
intercept column is added.</p></li>
<li><p>It coerces the result of the above steps to a tibble.</p></li>
</ul></li>
<li><p>Outcomes</p><ul><li><p>It runs <code><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">stats::model.frame()</a></code> on <code>new_data</code> using the
stored terms object corresponding to the <em>outcomes</em>.</p></li>
<li><p>Coerces the result to a tibble.</p></li>
</ul></li>
</ul></div>
    <div class="section level2">
    <h2 id="differences-from-base-r">Differences From Base R<a class="anchor" aria-label="anchor" href="#differences-from-base-r"></a></h2>



<p>There are a number of differences from base R regarding how formulas are
processed by <code><a href="mold.html">mold()</a></code> that require some explanation.</p>
<p>Multivariate outcomes can be specified on the LHS using syntax that is
similar to the RHS (i.e. <code>outcome_1 + outcome_2 ~ predictors</code>).
If any complex calculations are done on the LHS and they return matrices
(like <code><a href="https://rdrr.io/r/stats/poly.html" class="external-link">stats::poly()</a></code>), then those matrices are flattened into multiple
columns of the tibble after the call to <code><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame()</a></code>. While this is
possible, it is not recommended, and if a large amount of preprocessing is
required on the outcomes, then you are better off
using a <code><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipes::recipe()</a></code>.</p>
<p>Global variables are <em>not</em> allowed in the formula. An error will be thrown
if they are included. All terms in the formula should come from <code>data</code>. If
you need to use inline functions in the formula, the safest way to do so is
to prefix them with their package name, like <code>pkg::fn()</code>. This ensures that
the function will always be available at <code><a href="mold.html">mold()</a></code> (fit) and <code><a href="forge.html">forge()</a></code>
(prediction) time. That said, if the package is <em>attached</em>
(i.e. with <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code>), then you should be able to use the inline function
without the prefix.</p>
<p>By default, intercepts are <em>not</em> included in the predictor output from the
formula. To include an intercept, set
<code>blueprint = default_formula_blueprint(intercept = TRUE)</code>. The rationale
for this is that many packages either always require or never allow an
intercept (for example, the <code>earth</code> package), and they do a large amount of
extra work to keep the user from supplying one or removing it. This
interface standardizes all of that flexibility in one place.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># ---------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"hardhat-example-data"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Formula Example</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Call mold() with the training data</span></span></span>
<span class="r-in"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">num_1</span><span class="op">)</span> <span class="op">~</span> <span class="va">num_2</span> <span class="op">+</span> <span class="va">fac_1</span>,</span></span>
<span class="r-in"><span>  <span class="va">example_train</span>,</span></span>
<span class="r-in"><span>  blueprint <span class="op">=</span> <span class="fu">default_formula_blueprint</span><span class="op">(</span>intercept <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Then, call forge() with the blueprint and the test data</span></span></span>
<span class="r-in"><span><span class="co"># to have it preprocess the test data in the same way</span></span></span>
<span class="r-in"><span><span class="fu"><a href="forge.html">forge</a></span><span class="op">(</span><span class="va">example_test</span>, <span class="va">processed</span><span class="op">$</span><span class="va">blueprint</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $predictors</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   `(Intercept)` num_2 fac_1b fac_1c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>             1 0.967      0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>             1 0.761      0      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $outcomes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extras</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extras$offset</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use `outcomes = TRUE` to also extract the preprocessed outcome</span></span></span>
<span class="r-in"><span><span class="fu"><a href="forge.html">forge</a></span><span class="op">(</span><span class="va">example_test</span>, <span class="va">processed</span><span class="op">$</span><span class="va">blueprint</span>, outcomes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $predictors</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   `(Intercept)` num_2 fac_1b fac_1c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>             1 0.967      0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>             1 0.761      0      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $outcomes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 1</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   `log(num_1)`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>         3.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>         3.04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extras</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extras$offset</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Factors without an intercept</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># No intercept is added by default</span></span></span>
<span class="r-in"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span><span class="va">num_1</span> <span class="op">~</span> <span class="va">fac_1</span> <span class="op">+</span> <span class="va">fac_2</span>, <span class="va">example_train</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># So, for factor columns, the first factor is completely expanded into all</span></span></span>
<span class="r-in"><span><span class="co"># `K` columns (the number of levels), and the subsequent factors are expanded</span></span></span>
<span class="r-in"><span><span class="co"># into `K - 1` columns.</span></span></span>
<span class="r-in"><span><span class="va">processed</span><span class="op">$</span><span class="va">predictors</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    fac_1a fac_1b fac_1c fac_2B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>      1      0      0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>      1      0      0      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>      1      0      0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>      1      0      0      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>      0      1      0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>      0      1      0      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>      0      1      0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>      0      1      0      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>      0      0      1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>      0      0      1      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span>      0      0      1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span>      0      0      1      1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># In the above example, `fac_1` is expanded into all three columns,</span></span></span>
<span class="r-in"><span><span class="co"># `fac_2` is not. This behavior comes from `model.matrix()`, and is somewhat</span></span></span>
<span class="r-in"><span><span class="co"># known in the R community, but can lead to a model that is difficult to</span></span></span>
<span class="r-in"><span><span class="co"># interpret since the corresponding p-values are testing wildly different</span></span></span>
<span class="r-in"><span><span class="co"># hypotheses.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To get all indicators for all columns (irrespective of the intercept),</span></span></span>
<span class="r-in"><span><span class="co"># use the `indicators = "one_hot"` option</span></span></span>
<span class="r-in"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">num_1</span> <span class="op">~</span> <span class="va">fac_1</span> <span class="op">+</span> <span class="va">fac_2</span>,</span></span>
<span class="r-in"><span>  <span class="va">example_train</span>,</span></span>
<span class="r-in"><span>  blueprint <span class="op">=</span> <span class="fu">default_formula_blueprint</span><span class="op">(</span>indicators <span class="op">=</span> <span class="st">"one_hot"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">processed</span><span class="op">$</span><span class="va">predictors</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    fac_1a fac_1b fac_1c fac_2A fac_2B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>      1      0      0      1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>      1      0      0      0      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>      1      0      0      1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>      1      0      0      0      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>      0      1      0      1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>      0      1      0      0      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>      0      1      0      1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>      0      1      0      0      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>      0      0      1      1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>      0      0      1      0      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span>      0      0      1      1      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span>      0      0      1      0      1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># It is not possible to construct a no-intercept model that expands all</span></span></span>
<span class="r-in"><span><span class="co"># factors into `K - 1` columns using the formula method. If required, a</span></span></span>
<span class="r-in"><span><span class="co"># recipe could be used to construct this model.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Global variables</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">example_train</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># In base R, global variables are allowed in a model formula</span></span></span>
<span class="r-in"><span><span class="va">frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">fac_1</span> <span class="op">~</span> <span class="va">y</span> <span class="op">+</span> <span class="va">num_2</span>, <span class="va">example_train</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fac_1 y num_2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     a 1 0.579</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     a 1 0.338</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     a 1 0.206</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     a 1 0.546</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     b 1 0.964</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     b 1 0.631</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># mold() does not allow them, and throws an error</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span><span class="va">fac_1</span> <span class="op">~</span> <span class="va">y</span> <span class="op">+</span> <span class="va">num_2</span>, <span class="va">example_train</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in mold(fac_1 ~ y + num_2, example_train) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   The following predictor was not found in `data`: <span style="color: #0000BB;">"y"</span>.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Dummy variables and interactions</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># By default, factor columns are expanded</span></span></span>
<span class="r-in"><span><span class="co"># and interactions are created, both by</span></span></span>
<span class="r-in"><span><span class="co"># calling `model.matrix()`. Some models (like</span></span></span>
<span class="r-in"><span><span class="co"># tree based models) can take factors directly</span></span></span>
<span class="r-in"><span><span class="co"># but still might want to use the formula method.</span></span></span>
<span class="r-in"><span><span class="co"># In those cases, set `indicators = "none"` to not</span></span></span>
<span class="r-in"><span><span class="co"># run `model.matrix()` on factor columns. Interactions</span></span></span>
<span class="r-in"><span><span class="co"># are still allowed and are run on numeric columns.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">bp_no_indicators</span> <span class="op">&lt;-</span> <span class="fu">default_formula_blueprint</span><span class="op">(</span>indicators <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span> <span class="va">fac_1</span> <span class="op">+</span> <span class="va">num_1</span><span class="op">:</span><span class="va">num_2</span>,</span></span>
<span class="r-in"><span>  <span class="va">example_train</span>,</span></span>
<span class="r-in"><span>  blueprint <span class="op">=</span> <span class="va">bp_no_indicators</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">processed</span><span class="op">$</span><span class="va">predictors</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    `num_1:num_2` fac_1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>         0.579 a    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>         0.676 a    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>         0.618 a    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>         2.18  a    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>         4.82  b    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>         3.79  b    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>         5.66  b    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>         1.66  b    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>         2.84  c    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>         0.83  c    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span>         6.81  c    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span>         7.42  c    </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># An informative error is thrown when `indicators = "none"` and</span></span></span>
<span class="r-in"><span><span class="co"># factors are present in interaction terms or in inline functions</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span><span class="va">num_1</span> <span class="op">~</span> <span class="va">num_2</span><span class="op">:</span><span class="va">fac_1</span>, <span class="va">example_train</span>, blueprint <span class="op">=</span> <span class="va">bp_no_indicators</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in mold(num_1 ~ num_2:fac_1, example_train, blueprint = bp_no_indicators) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Interaction terms involving factors or characters have been</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> detected on the RHS of `formula`. These are not allowed when</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> `indicators = "none"`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Interactions terms involving factors were detected for <span style="color: #0000BB;">"fac_1"</span> in</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   `num_2:fac_1`.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span><span class="va">num_1</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">fac_1</span><span class="op">)</span>, <span class="va">example_train</span>, blueprint <span class="op">=</span> <span class="va">bp_no_indicators</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in mold(num_1 ~ paste0(fac_1), example_train, blueprint = bp_no_indicators) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Functions involving factors or characters have been detected on</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> the RHS of `formula`. These are not allowed when `indicators =</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> "none"`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Functions involving factors were detected for <span style="color: #0000BB;">"fac_1"</span> in</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   `paste0(fac_1)`.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Multivariate outcomes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Multivariate formulas can be specified easily</span></span></span>
<span class="r-in"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span><span class="va">num_1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">num_2</span><span class="op">)</span> <span class="op">~</span> <span class="va">fac_1</span>, <span class="va">example_train</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">processed</span><span class="op">$</span><span class="va">outcomes</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    num_1 `log(num_2)`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>     1      -<span style="color: #BB0000;">0.546</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>     2      -<span style="color: #BB0000;">1.08</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>     3      -<span style="color: #BB0000;">1.58</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>     4      -<span style="color: #BB0000;">0.605</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>     5      -<span style="color: #BB0000;">0.036</span><span style="color: #BB0000; text-decoration: underline;">7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>     6      -<span style="color: #BB0000;">0.460</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     7      -<span style="color: #BB0000;">0.213</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     8      -<span style="color: #BB0000;">1.57</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     9      -<span style="color: #BB0000;">1.15</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>    10      -<span style="color: #BB0000;">2.49</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span>    11      -<span style="color: #BB0000;">0.480</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span>    12      -<span style="color: #BB0000;">0.481</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inline functions on the LHS are run, but any matrix</span></span></span>
<span class="r-in"><span><span class="co"># output is flattened (like what happens in `model.matrix()`)</span></span></span>
<span class="r-in"><span><span class="co"># (essentially this means you don't wind up with columns</span></span></span>
<span class="r-in"><span><span class="co"># in the tibble that are matrices)</span></span></span>
<span class="r-in"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">num_2</span>, degree <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">~</span> <span class="va">fac_1</span>, <span class="va">example_train</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">processed</span><span class="op">$</span><span class="va">outcomes</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    `poly(num_2, degree = 2).1` `poly(num_2, degree = 2).2`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>                      0.098<span style="text-decoration: underline;">1</span>                      -<span style="color: #BB0000;">0.254</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>                     -<span style="color: #BB0000;">0.177</span>                       -<span style="color: #BB0000;">0.157</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>                     -<span style="color: #BB0000;">0.327</span>                        0.108</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>                      0.060<span style="text-decoration: underline;">4</span>                      -<span style="color: #BB0000;">0.270</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>                      0.537                        0.634</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>                      0.157                       -<span style="color: #BB0000;">0.209</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>                      0.359                        0.120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>                     -<span style="color: #BB0000;">0.325</span>                        0.103</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>                     -<span style="color: #BB0000;">0.202</span>                       -<span style="color: #BB0000;">0.124</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>                     -<span style="color: #BB0000;">0.468</span>                        0.492</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span>                      0.144                       -<span style="color: #BB0000;">0.221</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span>                      0.143                       -<span style="color: #BB0000;">0.222</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># TRUE</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">processed</span><span class="op">$</span><span class="va">outcomes</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Multivariate formulas specified in mold()</span></span></span>
<span class="r-in"><span><span class="co"># carry over into forge()</span></span></span>
<span class="r-in"><span><span class="fu"><a href="forge.html">forge</a></span><span class="op">(</span><span class="va">example_test</span>, <span class="va">processed</span><span class="op">$</span><span class="va">blueprint</span>, outcomes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $predictors</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fac_1a fac_1b fac_1c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>      1      0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>      0      0      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $outcomes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   `poly(num_2, degree = 2).1` `poly(num_2, degree = 2).2`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>                       0.541                     0.646  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>                       0.306                     0.006<span style="text-decoration: underline;">19</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extras</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extras$offset</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Offsets</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Offsets are handled specially in base R, so they deserve special</span></span></span>
<span class="r-in"><span><span class="co"># treatment here as well. You can add offsets using the inline function</span></span></span>
<span class="r-in"><span><span class="co"># `offset()`</span></span></span>
<span class="r-in"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span><span class="va">num_1</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">num_2</span><span class="op">)</span> <span class="op">+</span> <span class="va">fac_1</span>, <span class="va">example_train</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">processed</span><span class="op">$</span><span class="va">extras</span><span class="op">$</span><span class="va">offset</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 1</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    .offset</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>   0.579</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>   0.338</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>   0.206</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>   0.546</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>   0.964</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>   0.631</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>   0.808</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>   0.208</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>   0.316</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>   0.083</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span>   0.619</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span>   0.618</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Multiple offsets can be included, and they get added together</span></span></span>
<span class="r-in"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">num_1</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">num_2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">num_3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="va">example_train</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">processed</span><span class="op">$</span><span class="va">extras</span><span class="op">$</span><span class="va">offset</span><span class="op">$</span><span class="va">.offset</span>,</span></span>
<span class="r-in"><span>  <span class="va">example_train</span><span class="op">$</span><span class="va">num_2</span> <span class="op">+</span> <span class="va">example_train</span><span class="op">$</span><span class="va">num_3</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Forging test data will also require</span></span></span>
<span class="r-in"><span><span class="co"># and include the offset</span></span></span>
<span class="r-in"><span><span class="fu"><a href="forge.html">forge</a></span><span class="op">(</span><span class="va">example_test</span>, <span class="va">processed</span><span class="op">$</span><span class="va">blueprint</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $predictors</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 0</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $outcomes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extras</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extras$offset</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 1</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .offset</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>   1.06 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>   0.802</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Intercept only</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Because `1` and `0` are intercept modifying terms, they are</span></span></span>
<span class="r-in"><span><span class="co"># not allowed in the formula and are instead controlled by the</span></span></span>
<span class="r-in"><span><span class="co"># `intercept` argument of the blueprint. To use an intercept</span></span></span>
<span class="r-in"><span><span class="co"># only formula, you should supply `NULL` on the RHS of the formula.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>  <span class="va">example_train</span>,</span></span>
<span class="r-in"><span>  blueprint <span class="op">=</span> <span class="fu">default_formula_blueprint</span><span class="op">(</span>intercept <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $predictors</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 1</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    `(Intercept)`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span>             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span>             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $outcomes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 0</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $blueprint</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Formula blueprint:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> # Predictors: 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> # Outcomes: 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Intercept: TRUE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Novel Levels: FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Composition: tibble</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Indicators: traditional</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extras</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extras$offset</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Matrix output for predictors</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can change the `composition` of the predictor data set</span></span></span>
<span class="r-in"><span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="fu">default_formula_blueprint</span><span class="op">(</span>composition <span class="op">=</span> <span class="st">"dgCMatrix"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="mold.html">mold</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">num_1</span><span class="op">)</span> <span class="op">~</span> <span class="va">num_2</span> <span class="op">+</span> <span class="va">fac_1</span>, <span class="va">example_train</span>, blueprint <span class="op">=</span> <span class="va">bp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">processed</span><span class="op">$</span><span class="va">predictors</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "dgCMatrix"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"package")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Matrix"</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://frick.ws" class="external-link">Hannah Frick</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer></body></html>

